"use strict";
/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
(() => {
var exports = {};
exports.id = "pages/api/ai/chat";
exports.ids = ["pages/api/ai/chat"];
exports.modules = {

/***/ "@supabase/supabase-js":
/*!****************************************!*\
  !*** external "@supabase/supabase-js" ***!
  \****************************************/
/***/ ((module) => {

module.exports = require("@supabase/supabase-js");

/***/ }),

/***/ "openai":
/*!*************************!*\
  !*** external "openai" ***!
  \*************************/
/***/ ((module) => {

module.exports = import("openai");;

/***/ }),

/***/ "zod":
/*!**********************!*\
  !*** external "zod" ***!
  \**********************/
/***/ ((module) => {

module.exports = import("zod");;

/***/ }),

/***/ "(api)/./pages/api/ai/chat.js":
/*!******************************!*\
  !*** ./pages/api/ai/chat.js ***!
  \******************************/
/***/ ((module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.a(module, async (__webpack_handle_async_dependencies__, __webpack_async_result__) => { try {\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": () => (/* binding */ handler)\n/* harmony export */ });\n/* harmony import */ var openai__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! openai */ \"openai\");\n/* harmony import */ var zod__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! zod */ \"zod\");\n/* harmony import */ var _supabase_supabase_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @supabase/supabase-js */ \"@supabase/supabase-js\");\n/* harmony import */ var _supabase_supabase_js__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(_supabase_supabase_js__WEBPACK_IMPORTED_MODULE_2__);\nvar __webpack_async_dependencies__ = __webpack_handle_async_dependencies__([openai__WEBPACK_IMPORTED_MODULE_0__, zod__WEBPACK_IMPORTED_MODULE_1__]);\n([openai__WEBPACK_IMPORTED_MODULE_0__, zod__WEBPACK_IMPORTED_MODULE_1__] = __webpack_async_dependencies__.then ? (await __webpack_async_dependencies__)() : __webpack_async_dependencies__);\n\n\n\nconst supabase = (0,_supabase_supabase_js__WEBPACK_IMPORTED_MODULE_2__.createClient)(process.env.SUPABASE_URL, process.env.SUPABASE_SERVICE_ROLE_KEY); // Client instance for getting user from JWT\n\nconst supabaseClient = (0,_supabase_supabase_js__WEBPACK_IMPORTED_MODULE_2__.createClient)(process.env.SUPABASE_URL, \"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InJsbWhybmpwanhoeXd6c2tsd2x1Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDk1NzY1MDAsImV4cCI6MjA2NTE1MjUwMH0.HWXnyBx33CiP6UojHyFvLDvjIuDa-q4Gt5qYa4G4aro\"); // Zod schema for final model input\n\nconst ModelSchema = zod__WEBPACK_IMPORTED_MODULE_1__.z.object({\n  siteLocation: zod__WEBPACK_IMPORTED_MODULE_1__.z.string().min(1),\n  brandFlag: zod__WEBPACK_IMPORTED_MODULE_1__.z.string().min(1),\n  floorCount: zod__WEBPACK_IMPORTED_MODULE_1__.z.number().int().min(1).max(40),\n  roomTypes: zod__WEBPACK_IMPORTED_MODULE_1__.z.array(zod__WEBPACK_IMPORTED_MODULE_1__.z.string()).min(1),\n  floorMix: zod__WEBPACK_IMPORTED_MODULE_1__.z.array(zod__WEBPACK_IMPORTED_MODULE_1__.z.object({\n    floorIndex: zod__WEBPACK_IMPORTED_MODULE_1__.z.number().int().min(1),\n    roomsByType: zod__WEBPACK_IMPORTED_MODULE_1__.z.record(zod__WEBPACK_IMPORTED_MODULE_1__.z.number().int().min(0))\n  })),\n  publicAreas: zod__WEBPACK_IMPORTED_MODULE_1__.z.array(zod__WEBPACK_IMPORTED_MODULE_1__.z.object({\n    area: zod__WEBPACK_IMPORTED_MODULE_1__.z.string(),\n    enabled: zod__WEBPACK_IMPORTED_MODULE_1__.z.boolean(),\n    size: zod__WEBPACK_IMPORTED_MODULE_1__.z.number().int().min(0)\n  }))\n});\nconst openai = new openai__WEBPACK_IMPORTED_MODULE_0__.OpenAI({\n  apiKey: process.env.OPENAI_API_KEY\n}); // Define the conversation steps\n\nconst conversationSteps = [{\n  id: 'location',\n  question: \"Let's start with the basics! What city or ZIP code is your hotel project located in?\",\n  responseType: 'text',\n  extract: messages => {\n    const lastUserMessage = [...messages].reverse().find(m => m.role === 'user');\n    return lastUserMessage?.content;\n  }\n}, {\n  id: 'brand',\n  question: \"Great! What hotel brand or flag are you planning for this project?\",\n  responseType: 'choices',\n  choices: ['Marriott', 'Hilton', 'IHG', 'Hyatt', 'Choice Hotels', 'Wyndham', 'Independent', 'Other'],\n  allowCustom: true,\n  extract: messages => {\n    const lastUserMessage = [...messages].reverse().find(m => m.role === 'user');\n    return lastUserMessage?.content;\n  }\n}, {\n  id: 'floors',\n  question: \"How many floors will your hotel have? (Including ground floor)\",\n  responseType: 'text',\n  extract: messages => {\n    const lastUserMessage = [...messages].reverse().find(m => m.role === 'user');\n    const floors = parseInt(lastUserMessage?.content || '0');\n    return isNaN(floors) ? null : floors;\n  }\n}, {\n  id: 'roomTypes',\n  question: \"What types of rooms will you offer? Select all that apply:\",\n  responseType: 'choices',\n  choices: ['Standard King', 'Standard Double', 'Junior Suite', 'Executive Suite', 'Presidential Suite', 'Accessible Room'],\n  allowCustom: false,\n  multiSelect: true,\n  extract: messages => {\n    const lastUserMessage = [...messages].reverse().find(m => m.role === 'user');\n\n    try {\n      return JSON.parse(lastUserMessage?.content || '[]');\n    } catch {\n      return [lastUserMessage?.content];\n    }\n  }\n}, {\n  id: 'roomMix',\n  question: \"Now let's plan your room mix by floor. Please specify how many of each room type per floor:\",\n  responseType: 'table',\n  extract: (messages, data) => {\n    const lastUserMessage = [...messages].reverse().find(m => m.role === 'user');\n\n    try {\n      return JSON.parse(lastUserMessage?.content || '[]');\n    } catch {\n      return null;\n    }\n  }\n}, {\n  id: 'publicAreas',\n  question: \"Finally, which public areas and amenities will your hotel include?\",\n  responseType: 'areas',\n  publicAreas: ['Lobby', 'Restaurant', 'Bar/Lounge', 'Fitness Center', 'Business Center', 'Meeting Rooms', 'Pool', 'Spa', 'Gift Shop', 'Parking Garage'],\n  extract: messages => {\n    const lastUserMessage = [...messages].reverse().find(m => m.role === 'user');\n\n    try {\n      return JSON.parse(lastUserMessage?.content || '[]');\n    } catch {\n      return [];\n    }\n  }\n}];\n\nfunction extractDataFromMessages(messages) {\n  const data = {};\n  let currentStepIndex = 0; // Skip system message\n\n  const userMessages = messages.filter((m, i) => i > 0 && m.role === 'user');\n\n  for (let i = 0; i < userMessages.length && currentStepIndex < conversationSteps.length; i++) {\n    const step = conversationSteps[currentStepIndex];\n    const extracted = step.extract(messages.slice(0, (i + 1) * 2 + 1), data);\n\n    if (extracted !== null && extracted !== undefined) {\n      data[step.id] = extracted;\n      currentStepIndex++;\n    }\n  }\n\n  return {\n    data,\n    nextStepIndex: currentStepIndex\n  };\n}\n\nasync function handler(req, res) {\n  if (req.method !== 'POST') {\n    res.setHeader('Allow', ['POST']);\n    return res.status(405).end(`Method ${req.method} Not Allowed`);\n  }\n\n  const {\n    messages\n  } = req.body;\n\n  if (!messages || !Array.isArray(messages)) {\n    return res.status(400).json({\n      error: 'Messages array is required'\n    });\n  } // Get user from Authorization header\n\n\n  const authHeader = req.headers.authorization;\n\n  if (!authHeader) {\n    return res.status(401).json({\n      error: 'Authorization header required'\n    });\n  }\n\n  let user;\n\n  try {\n    const {\n      data: {\n        user: authUser\n      },\n      error: authError\n    } = await supabaseClient.auth.getUser(authHeader.replace('Bearer ', ''));\n\n    if (authError || !authUser) {\n      return res.status(401).json({\n        error: 'Invalid authorization token'\n      });\n    }\n\n    user = authUser;\n  } catch (err) {\n    return res.status(401).json({\n      error: 'Failed to authenticate user'\n    });\n  }\n\n  try {\n    const {\n      data,\n      nextStepIndex\n    } = extractDataFromMessages(messages); // Check if we have all the data needed\n\n    if (nextStepIndex >= conversationSteps.length) {\n      // Generate the final model\n      const model = {\n        siteLocation: data.location,\n        brandFlag: data.brand,\n        floorCount: data.floors,\n        roomTypes: data.roomTypes,\n        floorMix: data.roomMix,\n        publicAreas: data.publicAreas\n      }; // Validate the model\n\n      const validatedModel = ModelSchema.parse(model); // Save to database\n\n      const {\n        data: project,\n        error: projectError\n      } = await supabase.from('projects').insert([{\n        user_id: user.id,\n        name: `${validatedModel.brandFlag} Hotel - ${validatedModel.siteLocation}`,\n        status: 'Draft'\n      }]).select().single();\n      if (projectError) throw projectError;\n      const {\n        error: modelError\n      } = await supabase.from('hotel_base_models').insert([{\n        project_id: project.id,\n        data: validatedModel\n      }]);\n      if (modelError) throw modelError;\n      return res.status(200).json({\n        model: validatedModel,\n        projectId: project.id,\n        message: \"Perfect! I've created your hotel base model. Redirecting to your projects...\"\n      });\n    } // Get the next question\n\n\n    const nextStep = conversationSteps[nextStepIndex];\n    const question = {\n      id: nextStep.id,\n      text: nextStep.question,\n      responseType: nextStep.responseType,\n      choices: nextStep.choices,\n      allowCustom: nextStep.allowCustom,\n      multiSelect: nextStep.multiSelect,\n      floorCount: data.floors,\n      roomTypes: data.roomTypes,\n      publicAreas: nextStep.publicAreas\n    };\n    return res.status(200).json({\n      question\n    });\n  } catch (err) {\n    console.error('Chat API Error:', err);\n    return res.status(500).json({\n      error: err.message || 'An error occurred while processing your request'\n    });\n  }\n}\n__webpack_async_result__();\n} catch(e) { __webpack_async_result__(e); } });//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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SixJQUFlO0lBQXhCLENBQXJCLENBQVA7RUFDRDtBQUNGLEMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9mcm9udGVuZC8uL3BhZ2VzL2FwaS9haS9jaGF0LmpzP2JkOGUiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgT3BlbkFJIH0gZnJvbSAnb3BlbmFpJztcbmltcG9ydCB7IHogfSBmcm9tICd6b2QnO1xuaW1wb3J0IHsgY3JlYXRlQ2xpZW50IH0gZnJvbSAnQHN1cGFiYXNlL3N1cGFiYXNlLWpzJztcblxuY29uc3Qgc3VwYWJhc2UgPSBjcmVhdGVDbGllbnQoXG4gIHByb2Nlc3MuZW52LlNVUEFCQVNFX1VSTCxcbiAgcHJvY2Vzcy5lbnYuU1VQQUJBU0VfU0VSVklDRV9ST0xFX0tFWVxuKTtcblxuLy8gQ2xpZW50IGluc3RhbmNlIGZvciBnZXR0aW5nIHVzZXIgZnJvbSBKV1RcbmNvbnN0IHN1cGFiYXNlQ2xpZW50ID0gY3JlYXRlQ2xpZW50KFxuICBwcm9jZXNzLmVudi5TVVBBQkFTRV9VUkwsXG4gIHByb2Nlc3MuZW52Lk5FWFRfUFVCTElDX1NVUEFCQVNFX0FOT05fS0VZXG4pO1xuXG4vLyBab2Qgc2NoZW1hIGZvciBmaW5hbCBtb2RlbCBpbnB1dFxuY29uc3QgTW9kZWxTY2hlbWEgPSB6Lm9iamVjdCh7XG4gIHNpdGVMb2NhdGlvbjogei5zdHJpbmcoKS5taW4oMSksXG4gIGJyYW5kRmxhZzogei5zdHJpbmcoKS5taW4oMSksXG4gIGZsb29yQ291bnQ6IHoubnVtYmVyKCkuaW50KCkubWluKDEpLm1heCg0MCksXG4gIHJvb21UeXBlczogei5hcnJheSh6LnN0cmluZygpKS5taW4oMSksXG4gIGZsb29yTWl4OiB6LmFycmF5KFxuICAgIHoub2JqZWN0KHtcbiAgICAgIGZsb29ySW5kZXg6IHoubnVtYmVyKCkuaW50KCkubWluKDEpLFxuICAgICAgcm9vbXNCeVR5cGU6IHoucmVjb3JkKHoubnVtYmVyKCkuaW50KCkubWluKDApKVxuICAgIH0pXG4gICksXG4gIHB1YmxpY0FyZWFzOiB6LmFycmF5KFxuICAgIHoub2JqZWN0KHtcbiAgICAgIGFyZWE6IHouc3RyaW5nKCksXG4gICAgICBlbmFibGVkOiB6LmJvb2xlYW4oKSxcbiAgICAgIHNpemU6IHoubnVtYmVyKCkuaW50KCkubWluKDApXG4gICAgfSlcbiAgKVxufSk7XG5cbmNvbnN0IG9wZW5haSA9IG5ldyBPcGVuQUkoeyBhcGlLZXk6IHByb2Nlc3MuZW52Lk9QRU5BSV9BUElfS0VZIH0pO1xuXG4vLyBEZWZpbmUgdGhlIGNvbnZlcnNhdGlvbiBzdGVwc1xuY29uc3QgY29udmVyc2F0aW9uU3RlcHMgPSBbXG4gIHtcbiAgICBpZDogJ2xvY2F0aW9uJyxcbiAgICBxdWVzdGlvbjogXCJMZXQncyBzdGFydCB3aXRoIHRoZSBiYXNpY3MhIFdoYXQgY2l0eSBvciBaSVAgY29kZSBpcyB5b3VyIGhvdGVsIHByb2plY3QgbG9jYXRlZCBpbj9cIixcbiAgICByZXNwb25zZVR5cGU6ICd0ZXh0JyxcbiAgICBleHRyYWN0OiAobWVzc2FnZXMpID0+IHtcbiAgICAgIGNvbnN0IGxhc3RVc2VyTWVzc2FnZSA9IFsuLi5tZXNzYWdlc10ucmV2ZXJzZSgpLmZpbmQobSA9PiBtLnJvbGUgPT09ICd1c2VyJyk7XG4gICAgICByZXR1cm4gbGFzdFVzZXJNZXNzYWdlPy5jb250ZW50O1xuICAgIH1cbiAgfSxcbiAge1xuICAgIGlkOiAnYnJhbmQnLFxuICAgIHF1ZXN0aW9uOiBcIkdyZWF0ISBXaGF0IGhvdGVsIGJyYW5kIG9yIGZsYWcgYXJlIHlvdSBwbGFubmluZyBmb3IgdGhpcyBwcm9qZWN0P1wiLFxuICAgIHJlc3BvbnNlVHlwZTogJ2Nob2ljZXMnLFxuICAgIGNob2ljZXM6IFsnTWFycmlvdHQnLCAnSGlsdG9uJywgJ0lIRycsICdIeWF0dCcsICdDaG9pY2UgSG90ZWxzJywgJ1d5bmRoYW0nLCAnSW5kZXBlbmRlbnQnLCAnT3RoZXInXSxcbiAgICBhbGxvd0N1c3RvbTogdHJ1ZSxcbiAgICBleHRyYWN0OiAobWVzc2FnZXMpID0+IHtcbiAgICAgIGNvbnN0IGxhc3RVc2VyTWVzc2FnZSA9IFsuLi5tZXNzYWdlc10ucmV2ZXJzZSgpLmZpbmQobSA9PiBtLnJvbGUgPT09ICd1c2VyJyk7XG4gICAgICByZXR1cm4gbGFzdFVzZXJNZXNzYWdlPy5jb250ZW50O1xuICAgIH1cbiAgfSxcbiAge1xuICAgIGlkOiAnZmxvb3JzJyxcbiAgICBxdWVzdGlvbjogXCJIb3cgbWFueSBmbG9vcnMgd2lsbCB5b3VyIGhvdGVsIGhhdmU/IChJbmNsdWRpbmcgZ3JvdW5kIGZsb29yKVwiLFxuICAgIHJlc3BvbnNlVHlwZTogJ3RleHQnLFxuICAgIGV4dHJhY3Q6IChtZXNzYWdlcykgPT4ge1xuICAgICAgY29uc3QgbGFzdFVzZXJNZXNzYWdlID0gWy4uLm1lc3NhZ2VzXS5yZXZlcnNlKCkuZmluZChtID0+IG0ucm9sZSA9PT0gJ3VzZXInKTtcbiAgICAgIGNvbnN0IGZsb29ycyA9IHBhcnNlSW50KGxhc3RVc2VyTWVzc2FnZT8uY29udGVudCB8fCAnMCcpO1xuICAgICAgcmV0dXJuIGlzTmFOKGZsb29ycykgPyBudWxsIDogZmxvb3JzO1xuICAgIH1cbiAgfSxcbiAge1xuICAgIGlkOiAncm9vbVR5cGVzJyxcbiAgICBxdWVzdGlvbjogXCJXaGF0IHR5cGVzIG9mIHJvb21zIHdpbGwgeW91IG9mZmVyPyBTZWxlY3QgYWxsIHRoYXQgYXBwbHk6XCIsXG4gICAgcmVzcG9uc2VUeXBlOiAnY2hvaWNlcycsXG4gICAgY2hvaWNlczogWydTdGFuZGFyZCBLaW5nJywgJ1N0YW5kYXJkIERvdWJsZScsICdKdW5pb3IgU3VpdGUnLCAnRXhlY3V0aXZlIFN1aXRlJywgJ1ByZXNpZGVudGlhbCBTdWl0ZScsICdBY2Nlc3NpYmxlIFJvb20nXSxcbiAgICBhbGxvd0N1c3RvbTogZmFsc2UsXG4gICAgbXVsdGlTZWxlY3Q6IHRydWUsXG4gICAgZXh0cmFjdDogKG1lc3NhZ2VzKSA9PiB7XG4gICAgICBjb25zdCBsYXN0VXNlck1lc3NhZ2UgPSBbLi4ubWVzc2FnZXNdLnJldmVyc2UoKS5maW5kKG0gPT4gbS5yb2xlID09PSAndXNlcicpO1xuICAgICAgdHJ5IHtcbiAgICAgICAgcmV0dXJuIEpTT04ucGFyc2UobGFzdFVzZXJNZXNzYWdlPy5jb250ZW50IHx8ICdbXScpO1xuICAgICAgfSBjYXRjaCB7XG4gICAgICAgIHJldHVybiBbbGFzdFVzZXJNZXNzYWdlPy5jb250ZW50XTtcbiAgICAgIH1cbiAgICB9XG4gIH0sXG4gIHtcbiAgICBpZDogJ3Jvb21NaXgnLFxuICAgIHF1ZXN0aW9uOiBcIk5vdyBsZXQncyBwbGFuIHlvdXIgcm9vbSBtaXggYnkgZmxvb3IuIFBsZWFzZSBzcGVjaWZ5IGhvdyBtYW55IG9mIGVhY2ggcm9vbSB0eXBlIHBlciBmbG9vcjpcIixcbiAgICByZXNwb25zZVR5cGU6ICd0YWJsZScsXG4gICAgZXh0cmFjdDogKG1lc3NhZ2VzLCBkYXRhKSA9PiB7XG4gICAgICBjb25zdCBsYXN0VXNlck1lc3NhZ2UgPSBbLi4ubWVzc2FnZXNdLnJldmVyc2UoKS5maW5kKG0gPT4gbS5yb2xlID09PSAndXNlcicpO1xuICAgICAgdHJ5IHtcbiAgICAgICAgcmV0dXJuIEpTT04ucGFyc2UobGFzdFVzZXJNZXNzYWdlPy5jb250ZW50IHx8ICdbXScpO1xuICAgICAgfSBjYXRjaCB7XG4gICAgICAgIHJldHVybiBudWxsO1xuICAgICAgfVxuICAgIH1cbiAgfSxcbiAge1xuICAgIGlkOiAncHVibGljQXJlYXMnLFxuICAgIHF1ZXN0aW9uOiBcIkZpbmFsbHksIHdoaWNoIHB1YmxpYyBhcmVhcyBhbmQgYW1lbml0aWVzIHdpbGwgeW91ciBob3RlbCBpbmNsdWRlP1wiLFxuICAgIHJlc3BvbnNlVHlwZTogJ2FyZWFzJyxcbiAgICBwdWJsaWNBcmVhczogWydMb2JieScsICdSZXN0YXVyYW50JywgJ0Jhci9Mb3VuZ2UnLCAnRml0bmVzcyBDZW50ZXInLCAnQnVzaW5lc3MgQ2VudGVyJywgJ01lZXRpbmcgUm9vbXMnLCAnUG9vbCcsICdTcGEnLCAnR2lmdCBTaG9wJywgJ1BhcmtpbmcgR2FyYWdlJ10sXG4gICAgZXh0cmFjdDogKG1lc3NhZ2VzKSA9PiB7XG4gICAgICBjb25zdCBsYXN0VXNlck1lc3NhZ2UgPSBbLi4ubWVzc2FnZXNdLnJldmVyc2UoKS5maW5kKG0gPT4gbS5yb2xlID09PSAndXNlcicpO1xuICAgICAgdHJ5IHtcbiAgICAgICAgcmV0dXJuIEpTT04ucGFyc2UobGFzdFVzZXJNZXNzYWdlPy5jb250ZW50IHx8ICdbXScpO1xuICAgICAgfSBjYXRjaCB7XG4gICAgICAgIHJldHVybiBbXTtcbiAgICAgIH1cbiAgICB9XG4gIH1cbl07XG5cbmZ1bmN0aW9uIGV4dHJhY3REYXRhRnJvbU1lc3NhZ2VzKG1lc3NhZ2VzKSB7XG4gIGNvbnN0IGRhdGEgPSB7fTtcbiAgbGV0IGN1cnJlbnRTdGVwSW5kZXggPSAwO1xuICBcbiAgLy8gU2tpcCBzeXN0ZW0gbWVzc2FnZVxuICBjb25zdCB1c2VyTWVzc2FnZXMgPSBtZXNzYWdlcy5maWx0ZXIoKG0sIGkpID0+IGkgPiAwICYmIG0ucm9sZSA9PT0gJ3VzZXInKTtcbiAgXG4gIGZvciAobGV0IGkgPSAwOyBpIDwgdXNlck1lc3NhZ2VzLmxlbmd0aCAmJiBjdXJyZW50U3RlcEluZGV4IDwgY29udmVyc2F0aW9uU3RlcHMubGVuZ3RoOyBpKyspIHtcbiAgICBjb25zdCBzdGVwID0gY29udmVyc2F0aW9uU3RlcHNbY3VycmVudFN0ZXBJbmRleF07XG4gICAgY29uc3QgZXh0cmFjdGVkID0gc3RlcC5leHRyYWN0KG1lc3NhZ2VzLnNsaWNlKDAsIChpICsgMSkgKiAyICsgMSksIGRhdGEpO1xuICAgIGlmIChleHRyYWN0ZWQgIT09IG51bGwgJiYgZXh0cmFjdGVkICE9PSB1bmRlZmluZWQpIHtcbiAgICAgIGRhdGFbc3RlcC5pZF0gPSBleHRyYWN0ZWQ7XG4gICAgICBjdXJyZW50U3RlcEluZGV4Kys7XG4gICAgfVxuICB9XG4gIFxuICByZXR1cm4geyBkYXRhLCBuZXh0U3RlcEluZGV4OiBjdXJyZW50U3RlcEluZGV4IH07XG59XG5cbmV4cG9ydCBkZWZhdWx0IGFzeW5jIGZ1bmN0aW9uIGhhbmRsZXIocmVxLCByZXMpIHtcbiAgaWYgKHJlcS5tZXRob2QgIT09ICdQT1NUJykge1xuICAgIHJlcy5zZXRIZWFkZXIoJ0FsbG93JywgWydQT1NUJ10pO1xuICAgIHJldHVybiByZXMuc3RhdHVzKDQwNSkuZW5kKGBNZXRob2QgJHtyZXEubWV0aG9kfSBOb3QgQWxsb3dlZGApO1xuICB9XG5cbiAgY29uc3QgeyBtZXNzYWdlcyB9ID0gcmVxLmJvZHk7XG4gIGlmICghbWVzc2FnZXMgfHwgIUFycmF5LmlzQXJyYXkobWVzc2FnZXMpKSB7XG4gICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAwKS5qc29uKHsgZXJyb3I6ICdNZXNzYWdlcyBhcnJheSBpcyByZXF1aXJlZCcgfSk7XG4gIH1cblxuICAvLyBHZXQgdXNlciBmcm9tIEF1dGhvcml6YXRpb24gaGVhZGVyXG4gIGNvbnN0IGF1dGhIZWFkZXIgPSByZXEuaGVhZGVycy5hdXRob3JpemF0aW9uO1xuICBpZiAoIWF1dGhIZWFkZXIpIHtcbiAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDEpLmpzb24oeyBlcnJvcjogJ0F1dGhvcml6YXRpb24gaGVhZGVyIHJlcXVpcmVkJyB9KTtcbiAgfVxuXG4gIGxldCB1c2VyO1xuICB0cnkge1xuICAgIGNvbnN0IHsgZGF0YTogeyB1c2VyOiBhdXRoVXNlciB9LCBlcnJvcjogYXV0aEVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZUNsaWVudC5hdXRoLmdldFVzZXIoXG4gICAgICBhdXRoSGVhZGVyLnJlcGxhY2UoJ0JlYXJlciAnLCAnJylcbiAgICApO1xuICAgIGlmIChhdXRoRXJyb3IgfHwgIWF1dGhVc2VyKSB7XG4gICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDEpLmpzb24oeyBlcnJvcjogJ0ludmFsaWQgYXV0aG9yaXphdGlvbiB0b2tlbicgfSk7XG4gICAgfVxuICAgIHVzZXIgPSBhdXRoVXNlcjtcbiAgfSBjYXRjaCAoZXJyKSB7XG4gICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAxKS5qc29uKHsgZXJyb3I6ICdGYWlsZWQgdG8gYXV0aGVudGljYXRlIHVzZXInIH0pO1xuICB9XG5cbiAgdHJ5IHtcbiAgICBjb25zdCB7IGRhdGEsIG5leHRTdGVwSW5kZXggfSA9IGV4dHJhY3REYXRhRnJvbU1lc3NhZ2VzKG1lc3NhZ2VzKTtcbiAgICBcbiAgICAvLyBDaGVjayBpZiB3ZSBoYXZlIGFsbCB0aGUgZGF0YSBuZWVkZWRcbiAgICBpZiAobmV4dFN0ZXBJbmRleCA+PSBjb252ZXJzYXRpb25TdGVwcy5sZW5ndGgpIHtcbiAgICAgIC8vIEdlbmVyYXRlIHRoZSBmaW5hbCBtb2RlbFxuICAgICAgY29uc3QgbW9kZWwgPSB7XG4gICAgICAgIHNpdGVMb2NhdGlvbjogZGF0YS5sb2NhdGlvbixcbiAgICAgICAgYnJhbmRGbGFnOiBkYXRhLmJyYW5kLFxuICAgICAgICBmbG9vckNvdW50OiBkYXRhLmZsb29ycyxcbiAgICAgICAgcm9vbVR5cGVzOiBkYXRhLnJvb21UeXBlcyxcbiAgICAgICAgZmxvb3JNaXg6IGRhdGEucm9vbU1peCxcbiAgICAgICAgcHVibGljQXJlYXM6IGRhdGEucHVibGljQXJlYXNcbiAgICAgIH07XG4gICAgICBcbiAgICAgIC8vIFZhbGlkYXRlIHRoZSBtb2RlbFxuICAgICAgY29uc3QgdmFsaWRhdGVkTW9kZWwgPSBNb2RlbFNjaGVtYS5wYXJzZShtb2RlbCk7XG4gICAgICBcbiAgICAgIC8vIFNhdmUgdG8gZGF0YWJhc2VcbiAgICAgIGNvbnN0IHsgZGF0YTogcHJvamVjdCwgZXJyb3I6IHByb2plY3RFcnJvciB9ID0gYXdhaXQgc3VwYWJhc2VcbiAgICAgICAgLmZyb20oJ3Byb2plY3RzJylcbiAgICAgICAgLmluc2VydChbe1xuICAgICAgICAgIHVzZXJfaWQ6IHVzZXIuaWQsXG4gICAgICAgICAgbmFtZTogYCR7dmFsaWRhdGVkTW9kZWwuYnJhbmRGbGFnfSBIb3RlbCAtICR7dmFsaWRhdGVkTW9kZWwuc2l0ZUxvY2F0aW9ufWAsXG4gICAgICAgICAgc3RhdHVzOiAnRHJhZnQnXG4gICAgICAgIH1dKVxuICAgICAgICAuc2VsZWN0KClcbiAgICAgICAgLnNpbmdsZSgpO1xuICAgICAgXG4gICAgICBpZiAocHJvamVjdEVycm9yKSB0aHJvdyBwcm9qZWN0RXJyb3I7XG4gICAgICBcbiAgICAgIGNvbnN0IHsgZXJyb3I6IG1vZGVsRXJyb3IgfSA9IGF3YWl0IHN1cGFiYXNlXG4gICAgICAgIC5mcm9tKCdob3RlbF9iYXNlX21vZGVscycpXG4gICAgICAgIC5pbnNlcnQoW3tcbiAgICAgICAgICBwcm9qZWN0X2lkOiBwcm9qZWN0LmlkLFxuICAgICAgICAgIGRhdGE6IHZhbGlkYXRlZE1vZGVsXG4gICAgICAgIH1dKTtcbiAgICAgIFxuICAgICAgaWYgKG1vZGVsRXJyb3IpIHRocm93IG1vZGVsRXJyb3I7XG4gICAgICBcbiAgICAgIHJldHVybiByZXMuc3RhdHVzKDIwMCkuanNvbih7IFxuICAgICAgICBtb2RlbDogdmFsaWRhdGVkTW9kZWwsXG4gICAgICAgIHByb2plY3RJZDogcHJvamVjdC5pZCxcbiAgICAgICAgbWVzc2FnZTogXCJQZXJmZWN0ISBJJ3ZlIGNyZWF0ZWQgeW91ciBob3RlbCBiYXNlIG1vZGVsLiBSZWRpcmVjdGluZyB0byB5b3VyIHByb2plY3RzLi4uXCJcbiAgICAgIH0pO1xuICAgIH1cbiAgICBcbiAgICAvLyBHZXQgdGhlIG5leHQgcXVlc3Rpb25cbiAgICBjb25zdCBuZXh0U3RlcCA9IGNvbnZlcnNhdGlvblN0ZXBzW25leHRTdGVwSW5kZXhdO1xuICAgIGNvbnN0IHF1ZXN0aW9uID0ge1xuICAgICAgaWQ6IG5leHRTdGVwLmlkLFxuICAgICAgdGV4dDogbmV4dFN0ZXAucXVlc3Rpb24sXG4gICAgICByZXNwb25zZVR5cGU6IG5leHRTdGVwLnJlc3BvbnNlVHlwZSxcbiAgICAgIGNob2ljZXM6IG5leHRTdGVwLmNob2ljZXMsXG4gICAgICBhbGxvd0N1c3RvbTogbmV4dFN0ZXAuYWxsb3dDdXN0b20sXG4gICAgICBtdWx0aVNlbGVjdDogbmV4dFN0ZXAubXVsdGlTZWxlY3QsXG4gICAgICBmbG9vckNvdW50OiBkYXRhLmZsb29ycyxcbiAgICAgIHJvb21UeXBlczogZGF0YS5yb29tVHlwZXMsXG4gICAgICBwdWJsaWNBcmVhczogbmV4dFN0ZXAucHVibGljQXJlYXNcbiAgICB9O1xuICAgIFxuICAgIHJldHVybiByZXMuc3RhdHVzKDIwMCkuanNvbih7IHF1ZXN0aW9uIH0pO1xuICB9IGNhdGNoIChlcnIpIHtcbiAgICBjb25zb2xlLmVycm9yKCdDaGF0IEFQSSBFcnJvcjonLCBlcnIpO1xuICAgIHJldHVybiByZXMuc3RhdHVzKDUwMCkuanNvbih7IGVycm9yOiBlcnIubWVzc2FnZSB8fCAnQW4gZXJyb3Igb2NjdXJyZWQgd2hpbGUgcHJvY2Vzc2luZyB5b3VyIHJlcXVlc3QnIH0pO1xuICB9XG59ICJdLCJuYW1lcyI6WyJPcGVuQUkiLCJ6IiwiY3JlYXRlQ2xpZW50Iiwic3VwYWJhc2UiLCJwcm9jZXNzIiwiZW52IiwiU1VQQUJBU0VfVVJMIiwiU1VQQUJBU0VfU0VSVklDRV9ST0xFX0tFWSIsInN1cGFiYXNlQ2xpZW50IiwiTkVYVF9QVUJMSUNfU1VQQUJBU0VfQU5PTl9LRVkiLCJNb2RlbFNjaGVtYSIsIm9iamVjdCIsInNpdGVMb2NhdGlvbiIsInN0cmluZyIsIm1pbiIsImJyYW5kRmxhZyIsImZsb29yQ291bnQiLCJudW1iZXIiLCJpbnQiLCJtYXgiLCJyb29tVHlwZXMiLCJhcnJheSIsImZsb29yTWl4IiwiZmxvb3JJbmRleCIsInJvb21zQnlUeXBlIiwicmVjb3JkIiwicHVibGljQXJlYXMiLCJhcmVhIiwiZW5hYmxlZCIsImJvb2xlYW4iLCJzaXplIiwib3BlbmFpIiwiYXBpS2V5IiwiT1BFTkFJX0FQSV9LRVkiLCJjb252ZXJzYXRpb25TdGVwcyIsImlkIiwicXVlc3Rpb24iLCJyZXNwb25zZVR5cGUiLCJleHRyYWN0IiwibWVzc2FnZXMiLCJsYXN0VXNlck1lc3NhZ2UiLCJyZXZlcnNlIiwiZmluZCIsIm0iLCJyb2xlIiwiY29udGVudCIsImNob2ljZXMiLCJhbGxvd0N1c3RvbSIsImZsb29ycyIsInBhcnNlSW50IiwiaXNOYU4iLCJtdWx0aVNlbGVjdCIsIkpTT04iLCJwYXJzZSIsImRhdGEiLCJleHRyYWN0RGF0YUZyb21NZXNzYWdlcyIsImN1cnJlbnRTdGVwSW5kZXgiLCJ1c2VyTWVzc2FnZXMiLCJmaWx0ZXIiLCJpIiwibGVuZ3RoIiwic3RlcCIsImV4dHJhY3RlZCIsInNsaWNlIiwidW5kZWZpbmVkIiwibmV4dFN0ZXBJbmRleCIsImhhbmRsZXIiLCJyZXEiLCJyZXMiLCJtZXRob2QiLCJzZXRIZWFkZXIiLCJzdGF0dXMiLCJlbmQiLCJib2R5IiwiQXJyYXkiLCJpc0FycmF5IiwianNvbiIsImVycm9yIiwiYXV0aEhlYWRlciIsImhlYWRlcnMiLCJhdXRob3JpemF0aW9uIiwidXNlciIsImF1dGhVc2VyIiwiYXV0aEVycm9yIiwiYXV0aCIsImdldFVzZXIiLCJyZXBsYWNlIiwiZXJyIiwibW9kZWwiLCJsb2NhdGlvbiIsImJyYW5kIiwicm9vbU1peCIsInZhbGlkYXRlZE1vZGVsIiwicHJvamVjdCIsInByb2plY3RFcnJvciIsImZyb20iLCJpbnNlcnQiLCJ1c2VyX2lkIiwibmFtZSIsInNlbGVjdCIsInNpbmdsZSIsIm1vZGVsRXJyb3IiLCJwcm9qZWN0X2lkIiwicHJvamVjdElkIiwibWVzc2FnZSIsIm5leHRTdGVwIiwidGV4dCIsImNvbnNvbGUiXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(api)/./pages/api/ai/chat.js\n");

/***/ })

};
;

// load runtime
var __webpack_require__ = require("../../../webpack-api-runtime.js");
__webpack_require__.C(exports);
var __webpack_exec__ = (moduleId) => (__webpack_require__(__webpack_require__.s = moduleId))
var __webpack_exports__ = (__webpack_exec__("(api)/./pages/api/ai/chat.js"));
module.exports = __webpack_exports__;

})();